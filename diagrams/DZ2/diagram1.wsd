@startuml
title Оформление заказа в интернет-магазине — расширенная диаграмма

actor Customer as C
participant "Web UI" as UI
participant "Order Controller" as OC
database "Database" as DB
participant "Payment Service" as PS

' Этап 1. Оформление заказа 
group Оформление заказа
  C -> UI : Запрос на оформление заказа
  activate UI

  UI -> OC : Данные заказа
  activate OC

  OC -[#green]-> DB : Сохранить заказ  ' успешная операция (зелёный)
  activate DB
  DB --> OC : OK
  deactivate DB
end

' Этап 2. Оплата (альтернативы)
group Оплата
  OC -> PS : Провести платеж
  activate PS

  alt Успешная оплата
    PS -[#green]-> OC : Результат: Успех  ' успешная операция (зелёный)
    ' (опционально) асинхронное уведомление от платёжного сервиса
    opt Асинхронное уведомление (webhook)
      PS -[#lightblue]->> OC : Уведомление о платеже  ' асинхрон, светло-голубой
    end
  else Ошибка при платеже
    PS -[#red]-> OC : Ошибка платежа  ' ошибка (красный)
  end
  deactivate PS
end

' Этап 3. Подтверждение / информирование 
group Подтверждение
  ' Ветвление продолжения в зависимости от результата оплаты
  alt Оплата прошла успешно
    OC -> UI : Подтверждение заказа
    UI -> C : Информация о подтверждении
  else Оплата не прошла
    OC -[#red]-> UI : Сообщение об ошибке оплаты  ' ошибка (красный)
    UI -[#red]-> C : Уведомление об ошибке  ' ошибка (красный)
  end
end

deactivate OC
deactivate UI

@enduml
